{"version":1,"ops":[{"type":1,"author":{"id":"d94491c6df6dc52f4e132989f7ed217c066eb2cc"},"timestamp":1402047553,"metadata":{"github-id":"MDU6SXNzdWUzNTEzMTg5MA==","github-url":"https://github.com/rurban/B-Stats/issues/5","origin":"github"},"title":"Use of uninitialized value $class in hash element at C:/perl521/site/lib/B/Stats .pm line 366.","message":"Given \n\n```\n#!/usr/bin/perl -w\n\nuse Data::Dumper;\nmy %slim;\nprint Dumper(\\%slim);\n```\n\nand run as \"perl -MB::Stats=-r C:\\sources\\t4.pl\" I get\n\n```\nC:\\sources\\B-Stats\u003eperl -MB::Stats=-r C:\\sources\\t4.pl\n$VAR1 = {};\nUse of uninitialized value $class in hash element at C:/perl521/site/lib/B/Stats\n.pm line 366.\nUse of uninitialized value $class in hash element at C:/perl521/site/lib/B/Stats\n.pm line 366.\n\nB::Stats dynamic run-time:\nfiles=17        lines=7427      ops=142\n\nop name:\nconst           35\ngvsv            20\nnextstate       12\npadsv           10\npushmark        10\nand             5\nentersub        4\nor              4\npadrange        3\nsassign         3\nref             3\ngv              3\nanonlist        2\naassign         2\nanonhash        2\nhelem           2\ndefined         2\nleavesub        2\nrv2hv           2\naelemfast       2\nenter           2\nleave           2\nreturn          1\nbless           1\npadhv           1\nseq             1\nrefgen          1\ngt              1\nmethod_named    1\nrv2av           1\nmethod          1\nprint           1\n\nop class:\nSVOP            61\nOP              29\nCOP             12\nUNOP            11\nLISTOP          9\nLOGOP           9\nBINOP           6\n                5\n\nC:\\sources\\B-Stats\u003e\n```\n\nLine 366 is \n\n```\nsub output_runtime {\n  $r_count = {};\n  my $r_countarr = $_[0];\n\n  require Opcodes;\n  my $maxo = Opcodes::opcodes();\n  # @optype only since 5.8.9 in B\n  my @optype = qw(OP UNOP BINOP LOGOP LISTOP PMOP SVOP PADOP PVOP LOOP COP);\n  for my $i (0..$maxo-1) {\n    if (my $count = $r_countarr-\u003e[$i]) {\n      my $name = Opcodes::opname($i);\n      if ($name) {\n    my $class = $optype[ Opcodes::opclass($i) ];\n    next if $opt{f} and !$opt{f}-\u003e{name}-\u003e{$name};\n    next if $opt{f} and !$opt{f}-\u003e{class}-\u003e{$class};\n    $r_count-\u003e{name}-\u003e{ $name } += $count;\n    $rops += $count;\n    $r_count-\u003e{class}-\u003e{ $class } += $count;\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\u003c\n      } else {\n    warn \"invalid name for opcount[$i]\";\n      }\n    }\n  }\n  output($r_count, $rops, 'dynamic run-time');\n}\n```\n\nadding \"        warn Opcodes::opclass($i) if ! defined $class;\"  to the code says Opcodes::opclass($i) is returning 11. \n\n@optype only goes upto index 10 (\"COP\").\n\nIf I am reading op.h correctly\n\n```\n#define OA_BASEOP (0 \u003c\u003c OCSHIFT)\n#define OA_UNOP (1 \u003c\u003c OCSHIFT)\n#define OA_BINOP (2 \u003c\u003c OCSHIFT)\n#define OA_LOGOP (3 \u003c\u003c OCSHIFT)\n#define OA_LISTOP (4 \u003c\u003c OCSHIFT)\n#define OA_PMOP (5 \u003c\u003c OCSHIFT)\n#define OA_SVOP (6 \u003c\u003c OCSHIFT)\n#define OA_PADOP (7 \u003c\u003c OCSHIFT)\n#define OA_PVOP_OR_SVOP (8 \u003c\u003c OCSHIFT)\n#define OA_LOOP (9 \u003c\u003c OCSHIFT)\n#define OA_COP (10 \u003c\u003c OCSHIFT)\n#define OA_BASEOP_OR_UNOP (11 \u003c\u003c OCSHIFT)\n#define OA_FILESTATOP (12 \u003c\u003c OCSHIFT)\n#define OA_LOOPEXOP (13 \u003c\u003c OCSHIFT)\n```\n\nThere are 3 missing op classes from B::Stats.","files":null}]}